<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="QA System 優化報告 #6 - roles/departments/users 錯誤訊息洩漏修復 (2026-02-18)">
  <title>QA System 優化報告 #6 - roles/departments/users 錯誤訊息洩漏修復 (2026-02-18) | 知識庫</title>
  <link rel="stylesheet" href="../styles.css">
</head>
<body>
  <div class="reading-progress" id="readingProgress"></div>
  <header>
    <div class="container">
      <a href="../" class="logo">知識庫</a>
      <nav>
        <a href="../#buddhism">佛學</a>
        <a href="../#thinking">思維方法</a>
        <a href="../#ai">AI技術</a>
        <a href="../#claude">Claude Code</a>
        <a href="../#game">遊戲</a>
      </nav>
      <button class="theme-toggle" onclick="toggleTheme()" aria-label="切換深色模式">
        <span class="theme-icon">&#9680;</span>
      </button>
    </div>
  </header>

  <main class="container">
    <article>
      <div class="article-header">
        <span class="category-badge category-security">資訊安全</span>
        <h1>QA System 優化報告 #6 - roles/departments/users 錯誤訊息洩漏修復 (2026-02-18)</h1>
        <div class="article-meta">
          <span class="date">2026-02-18</span>
          <span class="reading-time">1 分鐘閱讀</span>
          <div class="tags"><span class="tag">QA System</span><span class="tag">安全優化</span><span class="tag">OWASP A05</span><span class="tag">錯誤訊息洩漏</span><span class="tag">品質改善</span></div>
        </div>
      </div>

      <details class="article-toc" open>
        <summary>目錄</summary>
        <ol>
          <li><a href="#優化方向">優化方向</a></li><li><a href="#已修復問題-6-項安全-1-項品質">已修復問題（6 項安全 + 1 項品質）</a></li>  <li><a href="#安全修復-owasp-a05-security-misconfiguration">安全修復（OWASP A05 - Security Misconfiguration）</a></li>  <li><a href="#品質修復">品質修復</a></li><li><a href="#驗證">驗證</a></li><li><a href="#品質趨勢">品質趨勢</a></li><li><a href="#下次待辦">下次待辦</a></li>
        </ol>
      </details>

      <div class="article-content">
        <h1>QA System 安全優化報告 #6</h1>
<blockquote><p>日期：2026-02-18 | 品質分數：4.5/5 | 第六次掃描</p>
</blockquote>
<h2 id="優化方向">優化方向</h2>
<p>roles.py + departments.py + users.py 錯誤訊息洩漏修復（OWASP A05 安全配置錯誤）</p>
<h2 id="已修復問題-6-項安全-1-項品質">已修復問題（6 項安全 + 1 項品質）</h2>
<h3 id="安全修復-owasp-a05-security-misconfiguration">安全修復（OWASP A05 - Security Misconfiguration）</h3>
<table>
<tr><th>檔案</th><th>端點</th><th>修復前</th><th>修復後</th></tr>
<tr><td>roles.py</td><td>create_role</td><td>str(e) 返回前端</td><td>「創建角色時發生系統錯誤，請稍後再試」</td></tr>
<tr><td>roles.py</td><td>update_role</td><td>str(e) 返回前端</td><td>「更新角色時發生系統錯誤，請稍後再試」</td></tr>
<tr><td>departments.py</td><td>delete_department</td><td>str(e) 返回前端</td><td>「刪除部門時發生系統錯誤，請稍後再試」</td></tr>
<tr><td>users.py</td><td>create_user</td><td>str(e) 返回前端</td><td>「創建用戶時發生系統錯誤，請稍後再試」</td></tr>
<tr><td>users.py</td><td>update_user</td><td>str(e) 返回前端</td><td>「更新用戶時發生系統錯誤，請稍後再試」</td></tr>
<tr><td>users.py</td><td>delete_user</td><td>str(e) 返回前端</td><td>「刪除用戶時發生系統錯誤，請稍後再試」</td></tr>
</table>
<h3 id="品質修復">品質修復</h3>
<ul>
<li>departments.py 缺少 logging import，已補上 + 加入 error logging</li>
</ul>
<h2 id="驗證">驗證</h2>
<ul>
<li>全專案 grep 確認：所有 error 欄位零殘留 str(e)</li>
<li>py_compile 語法檢查 3 檔案全部通過</li>
<li>pytest 9 通過 / 2 既有失敗（非本次引入）</li>
</ul>
<h2 id="品質趨勢">品質趨勢</h2>
<table>
<tr><th>次數</th><th>日期</th><th>方向</th><th>分數</th></tr>
<tr><td>#1</td><td>02-15</td><td>SQL 注入 + 硬編碼密碼 + Cookie</td><td>2.0</td></tr>
<tr><td>#2</td><td>02-16</td><td>SECRET_KEY + CORS + 錯誤洩漏</td><td>3.0</td></tr>
<tr><td>#3</td><td>02-16</td><td>print→logger + JWT + 版本鎖定</td><td>3.5</td></tr>
<tr><td>#4</td><td>02-17</td><td>重複函式 + SSO URL + Token 遮蔽</td><td>4.0</td></tr>
<tr><td>#5</td><td>02-17</td><td>JWT DRY + datetime.utcnow + questions.py 洩漏</td><td>4.5</td></tr>
<tr><td>#6</td><td>02-18</td><td>roles/dept/users str(e) 洩漏修復</td><td>4.5</td></tr>
</table>
<h2 id="下次待辦">下次待辦</h2>
<ol>
<li>questions.py 拆分（&gt;1000 行）</li>
<li>補全 users/roles/departments/export/reports 測試</li>
<li>修復既有失敗測試</li>
<li>TemplateResponse 棄用語法遷移</li>
<li>zeep cgi 模組棄用警告</li>
</ol>

      </div>

      <nav class="article-nav"><a href="qa-system-優化報告-7---python-jos-91a29fbe.html" class="nav-prev"><span class="nav-label">&larr; 上一篇</span><span class="nav-title">QA System 優化報告 #7 - python-jose CVE 修復 + TemplateResponse 棄用遷移 (2026-02-18)</span></a><a href="qa-system-優化報告-5---jwt-解碼整合d-863da04b.html" class="nav-next"><span class="nav-label">下一篇 &rarr;</span><span class="nav-title">QA System 優化報告 #5 - JWT 解碼整合、datetime.utcnow 遷移、錯誤訊息洩漏修復</span></a></nav>

      <a href="../" class="back-link">&larr; 返回首頁</a>
    </article>
  </main>

  <button class="back-to-top" id="backToTop" onclick="window.scrollTo({top:0,behavior:'smooth'})" aria-label="回到頂部">&uarr;</button>

  <footer>
    <div class="container">
      <p>Powered by RAG Knowledge Base</p>
    </div>
  </footer>
  <script>
    function toggleTheme(){const b=document.body;b.classList.toggle('dark');localStorage.setItem('theme',b.classList.contains('dark')?'dark':'light')}
    if(localStorage.getItem('theme')==='dark')document.body.classList.add('dark');
    window.addEventListener('scroll',function(){
      const prog=document.getElementById('readingProgress');
      const btn=document.getElementById('backToTop');
      const h=document.documentElement.scrollHeight-window.innerHeight;
      const pct=h>0?(window.scrollY/h)*100:0;
      prog.style.width=pct+'%';
      btn.classList.toggle('visible',window.scrollY>300);
    });
  </script>
</body>
</html>
